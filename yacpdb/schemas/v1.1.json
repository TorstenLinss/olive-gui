{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://www.yacpdb.org/schemas/v1.1.json",
  "type": "object",

  "properties": {
    "foreignids": { "type": "array", "items": { "$ref" : "#foreignid_type" }, "minItems": 1 },
    "authors": { "type": "array", "items": { "$ref" : "#author_type" }, "minItems": 1 },
    "source": { "$ref" : "#source_type" },
    "award": { "$ref" : "#award_type" },
    "reprints": { "type": "array", "items": { "$ref" : "#source_type" }, "minItems": 1 },
    "stipulation": { "$ref": "#label" },
    "algebraic" : {
      "type": "object",
      "patternProperties": {
        "^white|black|neutral$": { "$ref": "#/definitions/piece_decl_list" }
      },
      "additionalProperties": false
    },
    "twins" : {
      "type": "object",
      "patternProperties": {
        "^[a-z]|(z[0-9]+)$": { "type": "string", "minLength": 1 }
      },
      "required": ["b"],
      "additionalProperties": false
    },
    "intended-solutions": {
      "anyOf": [
        { "type": "integer", "minimum": 2 },
        { "type": "string", "pattern": "^[0-9]+(\\.[0-9]+)*(\\.\\.\\.)?$" }
      ]
    },
    "solution": { "$ref": "#text" },
    "options": { "$ref": "#label_list" },
    "keywords": { "$ref": "#label_list" },
    "comments": { "$ref": "#text_list" }
  },

  "required": ["stipulation", "algebraic", "solution"],
  "additionalProperties": false,

  "definitions": {

    "label" : {
      "$id": "#label",
      "anyOf": [
        { "type": "number" },
        { "type": "string", "minLength": 1, "maxLength": 255 }
      ]
    },

    "text" : {
      "$id": "#text",
      "anyOf": [
        { "type": "number" },
        { "type": "string", "minLength": 1 }
      ]
    },

    "label_list" : {
      "$id": "#label_list",
      "type": "array",
      "elements": { "$ref": "#label" },
      "minItems": 1,
      "uniqueItems": true
    },

    "text_list" : {
      "$id": "#text_list",
      "type": "array",
      "elements": { "$ref": "#text" },
      "minItems": 1,
      "uniqueItems": true
    },

    "year" : {
      "$id": "#year",
      "anyOf": [
        { "type": "integer", "minimum": 1, "maximum": 9999 },
        { "type": "string", "pattern": "^[0-9]{4}-[0-9]{4}$" }
      ]
    },

    "date_type" : {
      "$id": "#date_type",
      "type": "object",
      "properties" : {
        "year" : { "$ref" : "#year" },
        "month": { "type": "integer", "minimum": 1, "maximum": 12 },
        "day": { "type": "integer", "minimum": 1, "maximum": 31 }
      },
      "required": ["year"],
      "dependencies": {
        "day": { "required": ["month"] }
      },
      "additionalProperties": false
    },

    "source_type": {
      "$id": "#source_type",
      "type": "object",
      "properties": {
        "name": {"$ref" : "#label"},
        "date": {"$ref" : "#date_type"},
        "volume": {"$ref" : "#label"},
        "issue": {"$ref" : "#label"},
        "problemid": {"$ref" : "#label"}
      },
      "required": ["name", "date"],
      "additionalProperties": false
    },

    "tourney_type": {
      "$id": "#tourney_type",
      "type": "object",
      "properties": {
        "name": {"$ref" : "#label"},
        "date": {"$ref" : "#date_type"}
      },
      "required": ["name"],
      "additionalProperties": false
    },

    "distinction" : {
      "$id": "#distinction",
      "type": "string",
      "pattern": "^(?i)(((Special)|([0-9]*1st)|([0-9]*2nd)|([0-9]*3rd)|([0-9]*[0456789]th)|([0-9]*1[123]th))(-(([0-9]*1st)|([0-9]*2nd)|([0-9]*3rd)|([0-9]*[0456789]th)|([0-9]*1[123]th)))? )?(Special )?((Prize)|(Place)|(HM)|(Honorable Mention)|(Commendation)|(Comm\\.)|(cm))(, .*)?$"
    },

    "award_type": {
      "$id": "#award_type",
      "type": "object",
      "properties": {
        "tourney": {"$ref" : "#tourney_type"},
        "distinction": {"$ref" : "#distinction"}
      },
      "required": ["tourney", "distinction"],
      "additionalProperties": false
    },

    "author_type": {
      "$id": "#author_type",
      "type": "string",
      "pattern": "^[^,]+, [^,]+$",
      "maxLength": 255
    },

    "piece_decl": {
      "type": "string",
      "pattern": "^((Chameleon|Jigger|Kamikaze|Paralysing|Royal|Volage|Functionary|HalfNeutral|HurdleColourChanging|Protean|Magic|Uncapturable) )*[A-Za-z0-9]{1,2}[a-h][1-8]$"
    },

    "piece_decl_list": {
      "type": "array",
      "items": {"$ref": "#/definitions/piece_decl"},
      "minItems": 1,
      "uniqueItems": true
    },

    "foreignid_type": {
      "$id": "#foreignid_type",
      "type": "object",
      "properties": {
        "domain": {"$ref" : "#label"},
        "problemid": {"$ref" : "#label"}
      },
      "required": ["domain", "problemid"],
      "additionalProperties": false
    }

  }
}